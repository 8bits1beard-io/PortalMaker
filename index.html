<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PortalMaker - Design branded portal pages for kiosks and curated user experiences. Visual editor with live preview and enterprise deployment.">
    <title>PortalMaker</title>
    <link rel="icon" type="image/svg+xml" href="portalmaker-favicon.svg">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <header role="banner">
        <div class="header-brand">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="24" height="24" role="img" aria-hidden="true">
                <defs>
                    <linearGradient id="headerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#4F46E5"/>
                        <stop offset="100%" style="stop-color:#9333EA"/>
                    </linearGradient>
                </defs>
                <path d="M8 58 L8 28 Q8 6, 32 6 Q56 6, 56 28 L56 58 L46 58 L46 28 Q46 16, 32 16 Q18 16, 18 28 L18 58 Z" fill="url(#headerGradient)"/>
                <g transform="translate(32, 38) rotate(45)">
                    <rect x="-3.5" y="-16" width="7" height="22" rx="1.5" fill="white"/>
                    <path d="M-7 -16 L7 -16 L7 -10 L3.5 -10 L3.5 -7 L-3.5 -7 L-3.5 -10 L-7 -10 Z" fill="white"/>
                </g>
            </svg>
            <h1>PortalMaker</h1>
        </div>
        <div class="header-actions">
            <span id="saveIndicator" class="save-indicator" aria-live="polite"></span>
            <label for="importFileHeader" class="btn btn-secondary btn-sm header-btn" style="cursor: pointer;">
                Load
                <input type="file" id="importFileHeader" accept=".json,.html,.htm" onchange="importConfiguration(this)" class="visually-hidden">
            </label>
            <button type="button" class="btn btn-secondary btn-sm header-btn" onclick="exportConfiguration()">Save</button>
            <button type="button" class="btn btn-danger btn-sm header-btn" onclick="resetAll()" aria-label="Reset everything">Reset</button>
        </div>
    </header>

    <main id="main-content" class="container" role="main">
        <!-- Editor Panel -->
        <section class="panel" aria-labelledby="config-heading">
            <h2 id="config-heading" class="panel-header">Configuration</h2>
            <div class="panel-body editor-scroll">
                <!-- Tab Navigation -->
                <nav class="step-nav" role="tablist">
                    <button type="button" class="step-btn active" role="tab" aria-selected="true" aria-controls="tab-links" tabindex="0" onclick="switchTab('links')" onkeydown="handleTabKeydown(event)">
                        <span class="step-number">1</span>
                        <span class="step-label">Links</span>
                    </button>
                    <span class="step-arrow" aria-hidden="true">→</span>
                    <button type="button" class="step-btn" role="tab" aria-selected="false" aria-controls="tab-style" tabindex="-1" onclick="switchTab('style')" onkeydown="handleTabKeydown(event)">
                        <span class="step-number">2</span>
                        <span class="step-label">Style</span>
                    </button>
                    <span class="step-arrow" aria-hidden="true">→</span>
                    <button type="button" class="step-btn" role="tab" aria-selected="false" aria-controls="tab-page" tabindex="-1" onclick="switchTab('page')" onkeydown="handleTabKeydown(event)">
                        <span class="step-number">3</span>
                        <span class="step-label">Page</span>
                    </button>
                    <span class="step-arrow" aria-hidden="true">→</span>
                    <button type="button" class="step-btn" role="tab" aria-selected="false" aria-controls="tab-extras" tabindex="-1" onclick="switchTab('extras')" onkeydown="handleTabKeydown(event)">
                        <span class="step-number">4</span>
                        <span class="step-label">Extras</span>
                    </button>
                    <span class="step-arrow" aria-hidden="true">→</span>
                    <button type="button" class="step-btn" role="tab" aria-selected="false" aria-controls="tab-export" tabindex="-1" onclick="switchTab('export')" onkeydown="handleTabKeydown(event)">
                        <span class="step-number">5</span>
                        <span class="step-label">Export</span>
                    </button>
                </nav>

                <!-- Links Tab -->
                <div id="tab-links" class="tab-panel active" role="tabpanel">
                <!-- Link Groups -->
                <section aria-labelledby="groups-heading">
                    <h3 id="groups-heading" style="color: var(--primary); margin-bottom: 0.5rem;">Link Groups</h3>
                    <p id="groups-description" style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1rem;">
                        Organize links into groups with headings.
                    </p>

                    <div id="groupsContainer" class="groups-container" role="region" aria-labelledby="groups-heading" aria-describedby="groups-description" aria-live="polite">
                        <!-- Groups will be added here dynamically -->
                    </div>

                    <div class="actions-bar">
                        <button type="button" class="btn btn-primary" onclick="addGroup()" aria-describedby="groups-description">
                            + Add Group
                        </button>
                    </div>
                </section>

                <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid var(--border);">

                <!-- Standalone Links -->
                <section aria-labelledby="ungrouped-heading">
                    <div class="section-header" id="ungrouped-links-header" onclick="toggleSection('ungrouped-links')" aria-expanded="true" aria-controls="ungrouped-links-content" role="button" tabindex="0" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleSection('ungrouped-links')}">
                        <h3 id="ungrouped-heading" style="color: var(--primary); cursor: pointer;">
                            <span class="collapse-icon">&#9660;</span> Standalone Links
                        </h3>
                    </div>
                    <div class="section-content" id="ungrouped-links-content">
                    <p id="ungrouped-description" style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1rem;">
                        Links here appear without a group heading.
                    </p>

                    <div id="ungroupedLinksContainer" role="region" aria-labelledby="ungrouped-heading" aria-live="polite">
                        <!-- Ungrouped links will be added here -->
                    </div>

                    <div class="actions-bar">
                        <button type="button" class="btn btn-secondary" onclick="addUngroupedLink()" aria-describedby="ungrouped-description">
                            + Add URL
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="openPresetPicker()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <rect x="3" y="3" width="7" height="7"></rect>
                                <rect x="14" y="3" width="7" height="7"></rect>
                                <rect x="14" y="14" width="7" height="7"></rect>
                                <rect x="3" y="14" width="7" height="7"></rect>
                            </svg>
                            Add Application
                        </button>
                    </div>
                    </div>
                </section>

                <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid var(--border);">

                <div class="form-group">
                    <label class="toggle-label">
                        <input type="checkbox" id="suppressProtocolPrompts" checked>
                        <span>Suppress browser protocol prompts</span>
                    </label>
                    <small class="form-hint">Configures Edge/Chrome to launch app links without confirmation dialogs</small>
                </div>
                </div>

                <!-- Style Tab -->
                <div id="tab-style" class="tab-panel" role="tabpanel">
                <section aria-labelledby="theme-heading">
                    <p id="theme-description" style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1rem;">
                        Choose a color theme for your portal page.
                    </p>

                    <div class="theme-swatches" role="radiogroup" aria-labelledby="theme-heading" id="themeSwatches">
                        <!-- Swatches will be rendered by JavaScript -->
                    </div>

                    <div id="customColors" class="custom-colors">
                        <div class="color-input-group">
                            <label for="customPrimary">Primary Color</label>
                            <div class="color-input-row">
                                <input type="color" id="customPrimaryPicker" value="#0053E2" onchange="syncColorInput('primary', this.value)">
                                <input type="text" id="customPrimary" value="#0053E2" placeholder="#000000" oninput="syncColorPicker('primary', this.value)">
                            </div>
                        </div>
                        <div class="color-input-group">
                            <label for="customAccent">Accent Color</label>
                            <div class="color-input-row">
                                <input type="color" id="customAccentPicker" value="#FFC220" onchange="syncColorInput('accent', this.value)">
                                <input type="text" id="customAccent" value="#FFC220" placeholder="#000000" oninput="syncColorPicker('accent', this.value)">
                            </div>
                        </div>
                    </div>

                    <div id="customWarning" class="custom-warning">
                        Custom colors may not meet WCAG accessibility standards. Ensure sufficient contrast between background and text colors.
                    </div>

                    <fieldset class="advanced-colors-section">
                        <legend>Advanced Colors</legend>
                        <p class="section-hint">Fine-tune individual colors. Changes override the selected theme.</p>
                        <div id="advancedColorsGrid" class="advanced-colors-grid">
                            <!-- Color inputs rendered by JavaScript -->
                        </div>
                        <button type="button" class="btn btn-secondary btn-sm" onclick="resetColorOverrides()" style="margin-top: 1rem;">
                            Reset to Theme Defaults
                        </button>
                    </fieldset>
                </section>

                <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid var(--border);">

                <!-- LINK LAYOUT SECTION -->
                <div class="section-label">Link Layout</div>
                <div class="form-group">
                    <label for="linkLayout">Layout Style</label>
                    <select id="linkLayout" onchange="updatePreview()">
                        <option value="cards" selected>Cards</option>
                        <option value="list">List</option>
                        <option value="grid">Grid</option>
                    </select>
                </div>
                <div class="form-group" id="gridColumnsGroup" style="display: none;">
                    <label for="gridColumns">Grid Columns</label>
                    <select id="gridColumns" onchange="updatePreview()">
                        <option value="2">2</option>
                        <option value="3" selected>3</option>
                        <option value="4">4</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="buttonStyle">Button Style</label>
                    <select id="buttonStyle" onchange="updatePreview()">
                        <option value="rounded" selected>Rounded</option>
                        <option value="square">Square</option>
                        <option value="textonly">Text only</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="buttonSize">Button Size</label>
                    <select id="buttonSize" onchange="updatePreview()">
                        <option value="small">Small</option>
                        <option value="medium" selected>Medium</option>
                        <option value="large">Large</option>
                    </select>
                </div>
                </div>

                <!-- Page Tab -->
                <div id="tab-page" class="tab-panel" role="tabpanel">
                <fieldset style="border: none; padding: 0; margin: 0;">
                    <legend class="visually-hidden">Page Settings</legend>

                    <!-- CONTENT SECTION -->
                    <div class="section-label">Content</div>
                    <div class="form-group">
                        <label for="pageTitle">Page Title <small>(browser tab)</small></label>
                        <input type="text" id="pageTitle" value="Quick Links" oninput="debouncedUpdatePreview()">
                    </div>

                    <div class="form-group">
                        <label for="greeting">Greeting Text</label>
                        <input type="text" id="greeting" value="" oninput="debouncedUpdatePreview()">
                    </div>

                    <div class="form-group">
                        <label for="greetingFontSize">Greeting Font Size</label>
                        <div class="slider-row">
                            <input type="range" id="greetingFontSize" min="1.5" max="5" step="0.25" value="3" oninput="updateSliderValue(this); debouncedUpdatePreview()">
                            <span id="greetingFontSizeValue" class="slider-value">3rem</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="greetingSpacing">Greeting Spacing</label>
                        <div class="slider-row">
                            <input type="range" id="greetingSpacing" min="0" max="5" step="0.25" value="2.5" oninput="updateSliderValue(this); debouncedUpdatePreview()">
                            <span id="greetingSpacingValue" class="slider-value">2.5rem</span>
                        </div>
                    </div>

                    <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid var(--border);">

                    <!-- MAIN LOGO SECTION -->
                    <div class="section-label">Main Logo</div>
                    <div class="form-group">
                        <label for="topLogoUrl">Logo URL <small>(above greeting text)</small></label>
                        <div class="logo-input-row">
                            <input type="url" id="topLogoUrl" value="" placeholder="https://example.com/logo.png" oninput="debouncedUpdatePreview()">
                            <label for="topLogoUpload" class="btn btn-secondary btn-sm upload-btn">
                                Upload SVG
                                <input type="file" id="topLogoUpload" accept=".svg,image/svg+xml" onchange="handleLogoUpload('top', this)" class="visually-hidden">
                            </label>
                            <button type="button" class="btn btn-sm" onclick="clearLogo('top')" aria-label="Clear main logo" title="Clear">&#10005;</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="topLogoWidth">Logo Width</label>
                        <div class="slider-row">
                            <input type="range" id="topLogoWidth" min="100" max="600" step="10" value="360" oninput="updateSliderValue(this); debouncedUpdatePreview()">
                            <span id="topLogoWidthValue" class="slider-value">360px</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="topLogoSpacing">Logo Spacing</label>
                        <div class="slider-row">
                            <input type="range" id="topLogoSpacing" min="0" max="4" step="0.25" value="1.5" oninput="updateSliderValue(this); debouncedUpdatePreview()">
                            <span id="topLogoSpacingValue" class="slider-value">1.5rem</span>
                        </div>
                    </div>

                    <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid var(--border);">

                    <!-- SMALL LOGO SECTION -->
                    <div class="section-label">Small Logo</div>
                    <div class="form-group">
                        <label for="sideLogoUrl">Logo URL</label>
                        <div class="logo-input-row">
                            <input type="url" id="sideLogoUrl" value="" placeholder="https://example.com/logo.png" oninput="debouncedUpdatePreview()">
                            <label for="sideLogoUpload" class="btn btn-secondary btn-sm upload-btn">
                                Upload SVG
                                <input type="file" id="sideLogoUpload" accept=".svg,image/svg+xml" onchange="handleLogoUpload('side', this)" class="visually-hidden">
                            </label>
                            <button type="button" class="btn btn-sm" onclick="clearLogo('side')" aria-label="Clear small logo" title="Clear">&#10005;</button>
                        </div>
                    </div>

                    <div class="form-group" id="sideLogoPositionGroup" style="display: none;">
                        <label for="sideLogoPosition">Position</label>
                        <select id="sideLogoPosition" onchange="validatePositions(); updatePreview()">
                            <option value="left" selected>Left of greeting</option>
                            <option value="right">Right of greeting</option>
                            <option value="top-left">Top Left</option>
                            <option value="top-center">Top Center</option>
                            <option value="top-right">Top Right</option>
                            <option value="bottom-left">Bottom Left</option>
                            <option value="bottom-center">Bottom Center</option>
                            <option value="bottom-right">Bottom Right</option>
                        </select>
                        <small id="sideLogoPositionWarning" class="position-warning" style="display: none; color: var(--danger);">Position conflicts with another element</small>
                    </div>
                </fieldset>
                </div>

                <!-- Extras Tab -->
                <div id="tab-extras" class="tab-panel" role="tabpanel">
                <fieldset style="border: none; padding: 0; margin: 0;">
                    <legend class="visually-hidden">Extra Settings</legend>

                    <!-- CORNER OVERLAYS SECTION -->
                    <div class="section-label">Corner Overlays</div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="showComputerName" onchange="updatePreview()">
                            <label for="showComputerName">Show computer name</label>
                        </div>
                    </div>

                    <div class="form-group" id="computerNamePositionGroup">
                        <label for="computerNamePosition">Computer name position</label>
                        <select id="computerNamePosition" onchange="validatePositions(); updatePreview(); updateDateTimePositionOptions();">
                            <option value="top-right" selected>Top Right</option>
                            <option value="top-center">Top Center</option>
                            <option value="top-left">Top Left</option>
                            <option value="below-greeting">Below Greeting</option>
                            <option value="bottom-right">Bottom Right</option>
                            <option value="bottom-center">Bottom Center</option>
                            <option value="bottom-left">Bottom Left</option>
                        </select>
                        <small id="computerNamePositionWarning" class="position-warning" style="display: none; color: var(--danger);">Position conflicts with another element</small>
                    </div>

                    <div class="form-group" id="computerNameFormatGroup">
                        <label for="computerNameFormat">Format</label>
                        <select id="computerNameFormat" onchange="updatePreview()">
                            <option value="hostname" selected>Hostname only</option>
                            <option value="fqdn">Full FQDN</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="showNetworkIdentifier" onchange="validatePositions(); updatePreview(); updateDateTimePositionOptions();">
                            <label for="showNetworkIdentifier">Show identifier from FQDN</label>
                        </div>
                        <p style="color: var(--text-secondary); font-size: 0.75rem; margin: 0.35rem 0 0;">
                            Extract a portion of the device's fully qualified domain name (FQDN).
                        </p>
                    </div>

                    <div id="networkIdentifierDetails" style="display: none;">
                        <div class="form-group">
                            <label for="networkIdentifierDisplay">Display value</label>
                            <select id="networkIdentifierDisplay" onchange="updatePreview()">
                                <option value="fqdn">Full FQDN</option>
                                <option value="1" selected>Capture Group 1</option>
                                <option value="2">Capture Group 2</option>
                                <option value="3">Capture Group 3</option>
                                <option value="4">Capture Group 4</option>
                                <option value="5">Capture Group 5</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="networkIdentifierPattern">Pattern</label>
                            <input type="text" id="networkIdentifierPattern" value=".*s0(\d{4})\.(\w+)\..*" oninput="updatePreview()">
                            <small style="color: var(--text-secondary);">Regex pattern with capture groups. Select which group to display above.</small>
                        </div>

                        <div class="form-group">
                            <label for="networkIdentifierFallback">Fallback text</label>
                            <input type="text" id="networkIdentifierFallback" value="Unknown" oninput="updatePreview()">
                        </div>
                    </div>

                    <div class="form-group" id="networkIdentifierPositionGroup" style="display: none;">
                        <label for="networkIdentifierPosition">Identifier position</label>
                        <select id="networkIdentifierPosition" onchange="validatePositions(); updatePreview(); updateDateTimePositionOptions();">
                            <option value="top-left" selected>Top Left</option>
                            <option value="top-center">Top Center</option>
                            <option value="top-right">Top Right</option>
                            <option value="below-greeting">Below Greeting</option>
                            <option value="bottom-right">Bottom Right</option>
                            <option value="bottom-center">Bottom Center</option>
                            <option value="bottom-left">Bottom Left</option>
                            <option value="footer">In Footer</option>
                        </select>
                        <small id="networkIdentifierPositionWarning" class="position-warning" style="display: none; color: var(--danger);">Position conflicts with another element</small>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="showDateTime" onchange="updatePreview()">
                            <label for="showDateTime">Show date/time <small>(ISO 8601)</small></label>
                        </div>
                    </div>

                    <div class="form-group" id="dateTimeOptionsGroup" style="display: none;">
                        <label for="dateTimeFormat">Display format</label>
                        <select id="dateTimeFormat" onchange="updatePreview()">
                            <option value="both" selected>Date and Time</option>
                            <option value="date">Date only</option>
                            <option value="time">Time only</option>
                        </select>
                    </div>

                    <div class="form-group" id="dateTimePositionGroup" style="display: none;">
                        <label for="dateTimePosition">Date/time position</label>
                        <select id="dateTimePosition" onchange="validatePositions(); updatePreview()">
                            <option value="top-left">Top Left</option>
                            <option value="top-center">Top Center</option>
                            <option value="top-right">Top Right</option>
                            <option value="bottom-right">Bottom Right</option>
                            <option value="bottom-center">Bottom Center</option>
                            <option value="bottom-left">Bottom Left</option>
                            <option value="footer">In Footer</option>
                        </select>
                        <small id="dateTimePositionWarning" class="position-warning" style="display: none; color: var(--danger);">Position conflicts with another element</small>
                    </div>

                    <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid var(--border);">

                    <!-- FOOTER SECTION -->
                    <div class="section-label">Footer</div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="showFooter" onchange="updatePreview()">
                            <label for="showFooter">Show footer</label>
                        </div>
                    </div>

                    <div class="form-group" id="footerTextGroup">
                        <label for="footerText">Footer Text</label>
                        <input type="text" id="footerText" value="" oninput="debouncedUpdatePreview()">
                    </div>

                    <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid var(--border);">

                    <!-- AUTO-REDIRECT SECTION -->
                    <div class="section-label">Auto-Redirect</div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="enableAutoRefresh" onchange="updatePreview()">
                            <label for="enableAutoRefresh">Enable auto-redirect</label>
                        </div>
                    </div>

                    <div class="form-group" id="autoRefreshOptionsGroup" style="display: none;">
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <div style="flex: 0 0 auto;">
                                <label for="autoRefreshDelay">Delay (seconds)</label>
                                <input type="number" id="autoRefreshDelay" value="30" min="1" max="3600" style="width: 80px;" oninput="debouncedUpdatePreview()">
                            </div>
                            <div style="flex: 1; min-width: 200px;">
                                <label for="autoRefreshUrl">Redirect URL</label>
                                <input type="url" id="autoRefreshUrl" value="" placeholder="https://example.com" oninput="debouncedUpdatePreview()" onblur="validateUrlInput(this)">
                            </div>
                        </div>
                    </div>

                    <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid var(--border);">

                    <!-- ANNOUNCEMENT BANNER SECTION -->
                    <div class="section-label">Announcement Banner</div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="bannerEnabled" onchange="updatePreview()">
                            <label for="bannerEnabled">Show announcement banner</label>
                        </div>
                    </div>
                    <div id="bannerOptionsGroup" style="display: none;">
                        <div class="form-group">
                            <label for="bannerTitle">Title <small>(optional)</small></label>
                            <input type="text" id="bannerTitle" value="" placeholder="Important Notice" oninput="debouncedUpdatePreview()">
                        </div>
                        <div class="form-group">
                            <label for="bannerMessage">Message</label>
                            <input type="text" id="bannerMessage" value="" placeholder="Enter your announcement message..." oninput="debouncedUpdatePreview()">
                        </div>
                        <div class="form-group">
                            <label for="bannerStyle">Style</label>
                            <select id="bannerStyle" onchange="updatePreview()">
                                <option value="info" selected>Info (blue)</option>
                                <option value="warning">Warning (yellow)</option>
                                <option value="urgent">Urgent (red)</option>
                            </select>
                        </div>
                    </div>
                </fieldset>
                </div>

                <!-- Export Tab -->
                <div id="tab-export" class="tab-panel" role="tabpanel">
                <!-- DEPLOYMENT SETTINGS -->
                <fieldset>
                    <legend>Deployment</legend>
                    <div class="form-group">
                        <label for="scriptName">Script Name <small>(used in filename)</small></label>
                        <input type="text" id="scriptName" value="MyPortal" placeholder="MyPortal" oninput="debouncedUpdatePreview()">
                    </div>
                    <div class="form-group">
                        <label for="destinationPath">Destination Path</label>
                        <input type="text" id="destinationPath" value="C:\ProgramData\PortalMaker\index.html" placeholder="C:\ProgramData\PortalMaker\index.html">
                        <small class="form-hint">Where the portal HTML file will be saved on target machines</small>
                    </div>
                </fieldset>

                <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid var(--border);">

                <section class="output-section" aria-labelledby="output-heading">
                    <h3 id="output-heading" class="visually-hidden">Download Options</h3>

                    <div class="output-actions" style="flex-direction: column; align-items: center; padding-top: 1rem;">
                        <button type="button" class="btn btn-generate" onclick="downloadScript()">
                            Download PowerShell Script
                        </button>
                        <p style="font-size: 0.75rem; color: var(--text-secondary); margin: 0.5rem 0;">
                            Run directly on target devices, package as an Intune Win32 app, or use in an SCCM Task Sequence.
                        </p>
                    </div>
                </section>
                </div>
            </div>
        </section>

        <!-- Preview Panel -->
        <section class="panel preview-container" aria-labelledby="preview-heading">
            <h2 id="preview-heading" class="panel-header">Live Preview</h2>
            <div class="preview-frame">
                <iframe id="previewFrame" title="Portal preview"></iframe>
            </div>
        </section>
    </main>

    <footer role="contentinfo">
        <p>PortalMaker <span id="appVersion" aria-label="Version"></span> | Author: <a href="https://www.linkedin.com/in/joshua-walderbach" target="_blank" rel="noopener noreferrer">Joshua Walderbach</a></p>
    </footer>

    <!-- Screen reader announcements -->
    <div id="sr-announcements" class="visually-hidden" role="status" aria-live="polite" aria-atomic="true"></div>

    <!-- Instruction modal -->
    <div id="instructionModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modal-title">PowerShell Script Downloaded</h2>
                <button type="button" class="modal-close" onclick="closeModal()" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content will be populated by JavaScript -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="closeModal()">Got it</button>
            </div>
        </div>
    </div>

    <!-- Icon picker modal -->
    <div id="iconPickerModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="icon-picker-title">
        <div class="modal icon-picker-modal">
            <div class="modal-header">
                <h2 id="icon-picker-title">Choose an Icon</h2>
                <button type="button" class="modal-close" onclick="closeIconPicker()" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="icon-picker-search">
                    <input type="text" id="iconSearchInput" placeholder="Search icons..."
                           oninput="filterIcons(this.value)" aria-label="Search icons">
                </div>
                <div id="iconPickerGrid" class="icon-picker-grid">
                    <!-- Icons rendered by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- App Preset Picker Modal -->
    <div id="preset-picker-modal" class="preset-picker-overlay" role="dialog" aria-modal="true" aria-labelledby="preset-picker-title" hidden>
        <div class="preset-picker-container">
            <div class="preset-picker-header">
                <h2 id="preset-picker-title">Add Application</h2>
                <button type="button" class="preset-picker-close" onclick="closePresetPicker()" aria-label="Close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="preset-picker-search">
                <input type="text" id="preset-search" placeholder="Search apps..." oninput="filterPresets(this.value)">
            </div>
            <div class="preset-picker-body">
                <div id="preset-grid" class="preset-grid">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Preset Form Modal -->
    <div id="custom-preset-modal" class="preset-picker-overlay" role="dialog" aria-modal="true" aria-labelledby="custom-preset-title" hidden>
        <div class="preset-picker-container custom-preset-form-container">
            <div class="preset-picker-header">
                <h2 id="custom-preset-title">Create Custom Application</h2>
                <button type="button" class="preset-picker-close" onclick="closeCustomPresetForm()" aria-label="Close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="preset-picker-body">
                <div class="form-group">
                    <label for="customPresetName">Name <span class="required">*</span></label>
                    <input type="text" id="customPresetName" placeholder="My Application" required>
                </div>
                <div class="form-group">
                    <label for="customPresetUrl">URL / Command <span class="required">*</span></label>
                    <input type="text" id="customPresetUrl" placeholder="myapp: or https://example.com" required>
                    <small class="help-text">Examples: calculator:, ms-settings:, https://example.com, notepad.exe</small>
                </div>
                <div class="form-group">
                    <label for="customPresetCategory">Category</label>
                    <input type="text" id="customPresetCategory" placeholder="Custom" list="preset-categories-list">
                    <datalist id="preset-categories-list">
                        <!-- Populated by JavaScript -->
                    </datalist>
                </div>
                <div class="form-group">
                    <label for="customPresetIcon">Icon (SVG)</label>
                    <div class="custom-preset-icon-row">
                        <input type="text" id="customPresetIcon" placeholder="Paste SVG or select from library" oninput="updatePresetIconPreview()">
                        <button type="button" class="btn btn-secondary btn-sm" onclick="openIconPickerForPreset()" title="Choose from library">Library</button>
                    </div>
                    <div id="customPresetIconPreview" class="icon-preview"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeCustomPresetForm()">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveCustomPreset()">Save</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
