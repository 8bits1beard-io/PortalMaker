# Enterprise Deployment Guide

This guide covers deploying PortalMaker-generated pages to Windows devices using enterprise management tools.

## PowerShell Script Deployment

The generated PowerShell script (`Generate-Portal_[ScriptName].ps1`) handles:

- Creating the destination folder
- Writing the HTML file
- Registering `PortalMaker-*` custom protocol handlers for legacy Windows apps
- Configuring browser policies to suppress "Open app?" dialogs (optional)
- Logging all operations

### Script Parameters

| Parameter | Description |
|-----------|-------------|
| `-Uninstall` | Remove the portal |

### Intune Deployment

1. **Download** the PowerShell script from PortalMaker
2. In **Intune Admin Center**, go to **Devices > Scripts**
3. Click **Add > Windows 10 and later**
4. Upload the `.ps1` file
5. Configure:
   - Run this script using the logged on credentials: **No**
   - Enforce script signature check: **No**
   - Run script in 64 bit PowerShell Host: **Yes**
6. Assign to device groups

### Intune Win32 App Deployment

For more control (detection rules, dependencies, uninstall):

1. **Package** the script using the [Microsoft Win32 Content Prep Tool](https://github.com/Microsoft/Microsoft-Win32-Content-Prep-Tool):
   ```cmd
   IntuneWinAppUtil.exe -c <source_folder> -s Generate-Portal_MyScript.ps1 -o <output_folder>
   ```

2. In **Intune Admin Center**, go to **Apps > Windows**
3. Click **Add** and select **Windows app (Win32)**
4. Upload the `.intunewin` file
5. Configure:
   - **Install command**: `powershell.exe -ExecutionPolicy Bypass -File Generate-Portal_MyScript.ps1`
   - **Uninstall command**: `powershell.exe -ExecutionPolicy Bypass -File Generate-Portal_MyScript.ps1 -Uninstall`
   - **Detection rule**: File exists at destination path (e.g., `C:\ProgramData\PortalMaker\index.html`)

### SCCM/ConfigMgr Deployment

1. Create a **Package** with the PowerShell script as source
2. Create a **Program** with command line:
   ```
   powershell.exe -ExecutionPolicy Bypass -File Generate-Portal_MyScript.ps1
   ```
3. Deploy to target collection

## Kiosk Browser Configuration

### Microsoft Edge Kiosk Mode

Set Edge to open the portal in kiosk mode:

```
msedge.exe --kiosk "C:\ProgramData\PortalMaker\index.html" --edge-kiosk-type=fullscreen
```

For public browsing mode (with navigation):
```
msedge.exe --kiosk "C:\ProgramData\PortalMaker\index.html" --edge-kiosk-type=public-browsing
```

### Edge Kiosk Idle Timeout

Configure Edge to reset after a period of inactivity (useful for public kiosks):

**Via command line flag:**
```
msedge.exe --kiosk "C:\ProgramData\PortalMaker\index.html" --edge-kiosk-type=public-browsing --kiosk-idle-timeout-minutes=5
```

**Via Intune Settings Catalog:**
1. In **Intune Admin Center**, go to **Devices > Configuration profiles**
2. Create a new **Settings Catalog** profile
3. Add setting: **Microsoft Edge > Kiosk Mode > Configure Kiosk Reset After Idle Timeout**
4. Set the timeout value in minutes
5. Assign to kiosk device groups

### Windows Assigned Access (Single-App Kiosk)

1. Open **Settings > Accounts > Other users**
2. Click **Set up a kiosk**
3. Select **Microsoft Edge** as the kiosk app
4. Set the portal URL as the default page

### Multi-App Kiosk (Windows Configuration Designer)

Create a provisioning package with:
- Allowed apps including Edge
- Start layout with Edge tile pointing to the portal
- Shell launcher configuration

## File Locations

| Path | Purpose |
|------|---------|
| `C:\ProgramData\PortalMaker\` | Default installation folder |
| `C:\ProgramData\PortalMaker\index.html` | Portal HTML |
| `C:\ProgramData\PortalMaker\Logs\` | Installation logs |

## Protocol Handlers

For Windows apps without native URI schemes (Notepad, Task Manager, etc.), the script registers custom `PortalMaker-*` protocol handlers:

| Registry Location | Purpose |
|-------------------|---------|
| `HKCU\Software\Classes\PortalMaker-*` | Custom protocol handlers |
| `HKLM\SOFTWARE\Policies\Microsoft\Edge` | Edge browser policy |
| `HKLM\SOFTWARE\Policies\Google\Chrome` | Chrome browser policy |

**Note:** Browser policies require admin privileges. The script will log a warning if policies cannot be set.

## Troubleshooting

### App links don't open (protocol not registered)
- Ensure the PowerShell script was run (protocol handlers are registered at install time)
- Check registry for `HKCU\Software\Classes\PortalMaker-*` entries
- Run uninstall then reinstall: `.\Generate-Portal_MyScript.ps1 -Uninstall` then `.\Generate-Portal_MyScript.ps1`

### "Open app?" prompt still appears
- Browser policies require admin privileges to set
- Check `HKLM\SOFTWARE\Policies\Microsoft\Edge\AutoLaunchProtocolsFromOrigins` exists
- Restart the browser after policy changes

### Computer name shows as placeholder
- The HTML file must be generated by the PowerShell script on the target machine
- Direct HTML downloads show `%COMPUTERNAME%` placeholder

### FQDN not displaying correctly
- The generated PowerShell script uses `nslookup` for accurate PTR record resolution
- Ensure the device has network connectivity and DNS is properly configured
- Check that reverse DNS (PTR) records exist for the device

### Page doesn't load in kiosk mode
- Verify the HTML file exists at the configured path
- Check Edge kiosk policies allow local file access
- Review Windows Event Viewer for errors
